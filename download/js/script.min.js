/**
 * Helper function for passing arrays of promises to $.when
 * https://gist.github.com/830561
 */function buildScript(a,b){var c=[];$.n("Fetching src modules..."),$.ajax({url:"../src/core.js",dataType:"text",cache:!1}).done(function(d){c.push(d),$.whenArray($.map(a,function(a){return $.ajax({url:"../src/services/"+a+".js",dataType:"text",cache:!1}).done(function(a){c.push(a)})})).then(function(){$.n("All src moduled received"),$.n("Uglification..."),b(uglify(c.join(";")))})})}function onDownloadComplete(){checkboxes.enable(),buttons.download.disable(),buttons.build.enable()}function onBuildCompleted(a){$.n("Build completed"),builtScript=a,buttons.download.enable()}function build(){$.n("Build started"),checkboxes.disable(),buttons.build.disable(),buildScript($('input[type="checkbox"]').filter(":checked").map(function(){return $(this).attr("id")}).get(),onBuildCompleted)}function buildUI(a){$.n(a.length+" services available"),function(b,c,d,e,f){for(c=0,d=$("legend"),e=$('<div class="col"></div>').insertAfter(d);c<b;++c,d=e,e=$('<div class="col"></div>').insertAfter(d))for(f=c;f<a.length;f+=b)e.append('<div><label for="'+a[f]+'">'+'<input type="checkbox" id="'+a[f]+'">'+a[f]+"</label></div>")}(4),checkboxes=$('input[type="checkbox"]').extend({enable:function(){this.each(function(){$(this).removeAttr("disabled")});return this},disable:function(){this.each(function(){$(this).attr("disabled","disabled")});return this}}),buttons.build.disable().click(function(a){a.preventDefault(),build()}),$("form").delegate('form input[type="checkbox"]',"change",function(){var a=0;return function(){this.checked?a++:a--,a>0?buttons.build.enable():buttons.build.disable()}}()),Downloadify.create("button-bar",{filename:function(){return"jquery.lifestream.min.js"},data:function(){return builtScript},onComplete:onDownloadComplete,onError:function(){alert("You must put something in the File Contents or there will be nothing to save!")},transparent:!1,swf:"js/downloadify.swf",downloadImage:"img/download.png",width:100,height:30,append:!0}),setTimeout(function(){buttons.download=$("#button-bar > object").extend({enable:function(){this.css({visibility:"visible"});return this},disable:function(){this.css({visibility:"hidden"});return this}}),buttons.download.disable()},0)}jQuery.whenArray=function(a){return jQuery.when.apply(this,a)},$.n.defaults.timeout=8e3;var buttons={build:$("#button").extend({enable:function(){this.removeAttr("disabled");return this},disable:function(){this.attr("disabled","disabled");return this}}),download:undefined},checkboxes,builtScript="";$.n("Fetching available services..."),$.ajax({url:"services.json",dataType:"json",success:buildUI})