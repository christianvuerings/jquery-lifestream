(function(c){var l=function(f){return"http://query.yahooapis.com/v1/public/yql?q=__QUERY__&env=store://datatables.org/alltableswithkeys&format=json".replace("__QUERY__",encodeURIComponent(f))};c.fn.lifestream=function(f){return this.each(function(){var i=c(this),h=jQuery.extend({classname:"lifestream",feedloaded:null,limit:10,list:[]},f),b={count:h.list.length,items:[]},d=jQuery.extend(true,{},h),a=function(g){c.merge(b.items,g);b.items.sort(function(n,o){return o.date-n.date});g=b.items;for(var j=
g.length<h.limit?g.length:h.limit,k=0,m,p=c('<ul class="'+h.classname+'"/>');k<j;k++){m=g[k];m.html&&c('<li class="'+h.classname+"-"+m.config.service+'">').append(m.html).appendTo(p)}i.html(p);c.isFunction(h.feedloaded)&&h.feedloaded()},e=function(){var g=0,j=h.list.length;for(delete d.list;g<j;g++){var k=h.list[g];if(c.fn.lifestream.feeds[k.service]&&c.isFunction(c.fn.lifestream.feeds[k.service])&&k.user){k._settings=d;c.fn.lifestream.feeds[k.service](k,a)}}};jQuery.tmpl?e():jQuery.getScript("https://raw.github.com/jquery/jquery-tmpl/master/jquery.tmpl.min.js",
e)})};c.fn.lifestream.feeds=c.fn.lifestream.feeds||{};c.fn.lifestream.feeds.blogger=function(f,i){var h=c.extend({},{posted:'posted <a href="${origLink}">${title}</a>'},f.template);c.ajax({url:l('select * from xml where url="http://'+f.user+'.blogspot.com/feeds/posts/default"'),dataType:"jsonp",success:function(b){var d=[],a=0,e,g;if(b.query&&b.query.count&&b.query.count>0&&b.query.results.feed.entry){b=b.query.results.feed.entry;for(e=b.length;a<e;a++){g=b[a];d.push({date:new Date(g.published),config:f,
html:c.tmpl(h.posted,g)})}}i(d)}});return{template:h}};c.fn.lifestream.feeds.dailymotion=function(f,i){var h=c.extend({},{uploaded:'uploaded a video <a href="${link}">${title[0]}</a>'},f.template);c.ajax({url:l('select * from xml where url="http://www.dailymotion.com/rss/user/'+f.user+'"'),dataType:"jsonp",success:function(b){var d=[],a=0,e,g;if(b.query&&b.query.count&&b.query.count>0&&b.query.results.rss.channel.item){b=b.query.results.rss.channel.item;for(e=b.length;a<e;a++){g=b[a];d.push({date:new Date(g.pubDate),
config:f,html:c.tmpl(h.uploaded,g)})}}i(d)}});return{template:h}};c.fn.lifestream.feeds.delicious=function(f,i){var h=c.extend({},{bookmarked:'bookmarked <a href="${u}">${d}</a>'},f.template);c.ajax({url:"http://feeds.delicious.com/v2/json/"+f.user,dataType:"jsonp",success:function(b){var d=[],a=0,e;if(b&&b.length&&b.length>0)for(e=b.length;a<e;a++){var g=b[a];d.push({date:new Date(g.dt),config:f,html:c.tmpl(h.bookmarked,g)})}i(d)}});return{template:h}};c.fn.lifestream.feeds.deviantart=function(f,
i){var h=c.extend({},{posted:'posted <a href="${link}">${title}</a>'},f.template);c.ajax({url:l('select title,link,pubDate from rss where url="http://backend.deviantart.com/rss.xml?q=gallery%3A'+encodeURIComponent(f.user)+'&type=deviation" | unique(field="title")'),dataType:"jsonp",success:function(b){var d=[],a,e=0,g;if(b.query&&b.query.count>0){b=b.query.results.item;for(g=b.length;e<g;e++){a=b[e];d.push({date:new Date(a.pubDate),config:f,html:c.tmpl(h.posted,a)})}}i(d)}});return{template:h}};c.fn.lifestream.feeds.dribbble=
function(f,i){var h=c.extend({},{posted:'posted a shot <a href="${url}">${title}</a>'},f.template);c.ajax({url:"http://api.dribbble.com/players/"+f.user+"/shots",dataType:"jsonp",success:function(b){var d=[],a=0,e;if(b&&b.total)for(e=b.shots.length;a<e;a++){var g=b.shots[a];d.push({date:new Date(g.created_at),config:f,html:c.tmpl(h.posted,g)})}i(d)}});return{template:h}};c.fn.lifestream.feeds.flickr=function(f,i){var h=c.extend({},{posted:'posted a photo <a href="${link}">${title}</a>'},f.template);
c.ajax({url:"http://api.flickr.com/services/feeds/photos_public.gne?id="+f.user+"&lang=en-us&format=json",dataType:"jsonp",jsonp:"jsoncallback",success:function(b){var d=[],a=0,e;if(b&&b.items&&b.items.length>0)for(e=b.items.length;a<e;a++){var g=b.items[a];d.push({date:new Date(g.published),config:f,html:c.tmpl(h.posted,g)})}i(d)}});return{template:h}};c.fn.lifestream.feeds.formspring=function(f,i){var h=c.extend({},{answered:'answered a question <a href="${link}">${title}</a>'},f.template);c.ajax({url:l('select * from xml where url="http://www.formspring.me/profile/'+
f.user+'.rss"'),dataType:"jsonp",success:function(b){var d=[],a=0,e,g;if(b.query&&b.query.count&&b.query.count>0&&b.query.results.rss.channel.item){b=b.query.results.rss.channel.item;for(e=b.length;a<e;a++){g=b[a];d.push({date:new Date(g.pubDate),config:f,html:c.tmpl(h.answered,g)})}}i(d)}});return{template:h}};c.fn.lifestream.feeds.forrst=function(f,i){var h=c.extend({},{posted:'posted a ${post_type} <a href="${post_url}">${title}</a>'},f.template);c.ajax({url:"http://forrst.com/api/v2/users/posts?username="+
f.user,dataType:"jsonp",success:function(b){var d=[],a=0,e;if(b&&b.resp.length&&b.resp.length>0)for(e=b.resp.length;a<e;a++){var g=b.resp[a];d.push({date:new Date(g.created_at.replace(" ","T")),config:f,html:c.tmpl(h.posted,g)})}i(d)}});return{template:h}};c.fn.lifestream.feeds.foursquare=function(f,i){var h=c.extend({},{checkedin:'checked in @ <a href="${link}">${title}</a>'},f.template);c.ajax({url:l('select * from rss where url="https://feeds.foursquare.com/history/'+f.user+'.rss"'),dataType:"jsonp",
success:function(b){var d=[],a=0,e;if(b.query&&b.query.count&&b.query.count>0)for(e=b.query.count;a<e;a++){var g=b.query.results.item[a];d.push({date:new Date(g.pubDate),config:f,html:c.tmpl(h.checkedin,g)})}i(d)}});return{template:h}};c.fn.lifestream.feeds.github=function(f,i){var h=c.extend({},{pushed:'<a href="${status.url}" title="{{if title}}${title} by ${author} {{/if}}">pushed</a> to <a href="http://github.com/${repo}">${repo}</a>',gist:'<a href="${status.payload.url}" title="${status.payload.desc || ""}">${status.payload.name}</a>',
commented:'<a href="${status.url}">commented</a> on <a href="http://github.com/${repo}">${repo}</a>',pullrequest:'<a href="${status.url}">${status.payload.action}</a> pull request on <a href="http://github.com/${repo}">${repo}</a>',created:'created ${status.payload.ref_type || status.payload.object} <a href="${status.url}">${status.payload.ref || status.payload.object_name}</a> for <a href="http://github.com/${repo}">${repo}</a>',createdglobal:'created ${status.payload.object} <a href="${status.url}">${title}</a>',
deleted:'deleted ${status.payload.ref_type} <a href="http://github.com/${status.repository.owner}/${status.repository.name}">status.payload.ref</a>'},f.template),b=function(a){return a.payload.repo||a.repository.owner+"/"+a.repository.name},d=function(a){var e;if(a.type==="PushEvent"){e=a.payload&&a.payload.shas&&a.payload.shas.json&&a.payload.shas.json[2];b(a);return c.tmpl(h.pushed,{status:a,title:e,author:e?a.payload.shas.json[3]:"",repo:b(a)})}else if(a.type==="GistEvent")return c.tmpl(h.gist,
a);else if(a.type==="CommitCommentEvent"||a.type==="IssueCommentEvent"){e=b(a);return c.tmpl(h.commented,{repo:e,status:a})}else if(a.type==="PullRequestEvent"){e=b(a);return c.tmpl(h.pullrequest,{repo:e,status:a})}else if(a.type==="CreateEvent"&&(a.payload.ref_type==="tag"||a.payload.ref_type==="branch"||a.payload.object==="tag")){e=b(a);return c.tmpl(h.created,{repo:e,status:a})}else if(a.type==="CreateEvent"){e=a.payload.object_name==="null"?a.payload.name:a.payload.object_name;return c.tmpl(h.createdglobal,
{title:e,status:a})}else if(a.type==="DeleteEvent")return c.tmpl(h.deleted,a)};c.ajax({url:l('select json.repository.owner,json.repository.name,json.payload,json.type,json.url, json.created_at from json where url="http://github.com/'+f.user+'.json"'),dataType:"jsonp",success:function(a){var e=[],g=0,j;if(a.query&&a.query.count&&a.query.count>0)for(j=a.query.count;g<j;g++){var k=a.query.results.json[g].json;e.push({date:new Date(k.created_at),config:f,html:d(k)})}i(e)}});return{template:h}};c.fn.lifestream.feeds.googlereader=
function(f,i){var h=c.extend({},{starred:'starred post <a href="${link.href}">${title.content}</a>'},f.template);c.ajax({url:l('select * from xml where url="www.google.com/reader/public/atom/user%2F'+f.user+'%2Fstate%2Fcom.google%2Fstarred"'),dataType:"jsonp",success:function(b){var d=[],a=0,e;if(b.query&&b.query.count&&b.query.count>0){b=b.query.results.feed.entry;for(e=b.length;a<e;a++){var g=b[a];d.push({date:new Date(parseInt(g["crawl-timestamp-msec"],10)),config:f,html:c.tmpl(h.starred,g)})}}i(d)}});
return{template:h}};c.fn.lifestream.feeds.iusethis=function(f,i){var h=c.extend({},{global:'${action} <a href="${link}">${what}</a> on (${os})'},f.template);c.ajax({url:l('select * from xml where url="http://iphone.iusethis.com/user/feed.rss/'+f.user+'" or url="http://osx.iusethis.com/user/feed.rss/'+f.user+'" or url="http://win.iusethis.com/user/feed.rss/'+f.user+'"'),dataType:"jsonp",success:function(b){var d=[],a,e,g,j,k,m=0,p,n,o,q,r,s,t=["iPhone","OS X","Windows"];if(b.query&&b.query.count&&
b.query.count>0&&b.query.results.rss){p=b.query.results.rss.length;q=["started using","stopped using","stopped loving","Downloaded","commented on","updated entry for","started loving","registered"];for(k=q.length;m<p;m++){s=t[m];a=b.query.results.rss[m].channel.item;e=0;for(g=a.length;e<g;e++){n=a[e];o=n.title.replace(f.user+" ","");for(j=0;j<k;j++)if(o.indexOf(q[j])>-1){r=q[j];break}j=o.split(r);d.push({date:new Date(n.pubDate),config:f,html:c.tmpl(h.global,{action:r.toLowerCase(),link:n.link,what:j[1],
os:s})})}}}i(d)}});return{template:h}};c.fn.lifestream.feeds.lastfm=function(f,i){var h=c.extend({},{loved:'loved <a href="${url}">${name}</a> by <a href="${artist.url}">${artist.name}</a>'},f.template);c.ajax({url:l('select * from xml where url="http://ws.audioscrobbler.com/2.0/user/'+f.user+'/lovedtracks.xml"'),dataType:"jsonp",success:function(b){var d=[],a=0,e;if(b.query&&b.query.count&&b.query.count>0&&b.query.results.lovedtracks&&b.query.results.lovedtracks.track){b=b.query.results.lovedtracks.track;
for(e=b.length;a<e;a++){var g=b[a];d.push({date:new Date(parseInt(g.date.uts*1E3,10)),config:f,html:c.tmpl(h.loved,g)})}}i(d)}});return{template:h}};c.fn.lifestream.feeds.picplz=function(f,i){var h=c.extend({},{uploaded:'uploaded <a href="${url}">${title}</a>'},f.template);c.ajax({url:"http://picplz.com/api/v2/user.json?username="+f.user+"&include_pics=1",dataType:"jsonp",success:function(b){var d=[],a=0,e;if((e=b.value.users[0].pics)&&e.length&&e.length>0)for(b=e.length;a<b;a++){var g=e[a];d.push({date:new Date(g.date*
1E3),config:f,html:c.tmpl(h.uploaded,{url:g.pic_files["640r"].img_url,title:g.caption||g.id})})}i(d)}});return{template:h}};c.fn.lifestream.feeds.pinboard=function(f,i){var h=c.extend({},{bookmarked:'bookmarked <a href="${link}">${title}</a>'},f.template);c.ajax({url:l('select * from xml where url="http://feeds.pinboard.in/rss/u:'+f.user+'"'),dataType:"jsonp",success:function(b){var d=[],a=0,e,g;if(b.query&&b.query.count&&b.query.count>0){b=b.query.results.RDF.item;for(e=b.length;a<e;a++){g=b[a];
d.push({date:new Date(g.date),config:f,html:c.tmpl(h.bookmarked,g)})}}i(d)}});return{template:h}};c.fn.lifestream.feeds.posterous=function(f,i){var h=c.extend({},{posted:'posted <a href="${link}">${title}</a>'},f.template);c.ajax({url:l('select * from xml where url="http://'+f.user+'.posterous.com/rss.xml"'),dataType:"jsonp",success:function(b){var d=[],a=0,e,g;if(b.query&&b.query.count&&b.query.count>0&&b.query.results.rss.channel.item){b=b.query.results.rss.channel.item;for(e=b.length;a<e;a++){g=
b[a];d.push({date:new Date(g.pubDate),config:f,html:c.tmpl(h.posted,g)})}}i(d)}});return{template:h}};c.fn.lifestream.feeds.reddit=function(f,i){var h=c.extend({},{commented:'<a href="http://www.reddit.com/r/${item.data.subreddit}/comments/${item.data.link_id.substring(3)}/u/${item.data.name.substring(3)}?context=3">commented (${score})</a> in <a href="http://www.reddit.com/r/${item.data.subreddit}">${item.data.subreddit}</a>',created:'<a href="http://www.reddit.com${item.data.permalink}">created new thread (${score})</a> in <a href="http://www.reddit.com/r/${item.data.subreddit}">${item.data.subreddit}</a>'},
f.template),b=function(d){var a=d.data.ups-d.data.downs;a={item:d,score:a>0?"+"+a:a};if(d.kind==="t1")return c.tmpl(h.commented,a);else if(d.kind==="t3")return c.tmpl(h.created,a)};c.ajax({url:"http://www.reddit.com/user/"+f.user+".json",dataType:"jsonp",jsonp:"jsonp",success:function(d){var a=[],e=0,g;if(d&&d.data&&d.data.children&&d.data.children.length>0)for(g=d.data.children.length;e<g;e++){var j=d.data.children[e];a.push({date:new Date(j.data.created*1E3),config:f,html:b(j)})}i(a)}});return{template:h}};
c.fn.lifestream.feeds.slideshare=function(f,i){var h=c.extend({},{uploaded:'uploaded a presentation <a href="${link}">${title}</a>'},f.template);c.ajax({url:l('select * from xml where url="http://www.slideshare.net/rss/user/'+f.user+'"'),dataType:"jsonp",success:function(b){var d=[],a=0,e,g;if(b.query&&b.query.count&&b.query.count>0){b=b.query.results.rss.channel.item;for(e=b.length;a<e;a++){g=b[a];d.push({date:new Date(g.pubDate),config:f,html:c.tmpl(h.uploaded,g)})}}i(d)}});return{template:h}};
c.fn.lifestream.feeds.stackoverflow=function(f,i){var h=c.extend({},{global:'<a href="${link}">${text}</a> - ${title}'},f.template),b=function(d){var a="",e="",g="",j="http://stackoverflow.com/users/"+f.user;if(d.timeline_type==="badge"){a=d.timeline_type+" "+d.action+": "+d.description;e=d.detail;g=j+"?tab=reputation"}else if(d.timeline_type==="revision"||d.timeline_type==="comment"||d.timeline_type==="accepted"||d.timeline_type==="askoranswered"){a=d.post_type+" "+d.action;e=d.detail||d.description||
"";g="http://stackoverflow.com/questions/"+d.post_id}return{link:g,title:e,text:a}};c.ajax({url:"http://api.stackoverflow.com/1.1/users/"+f.user+"/timeline?jsonp",dataType:"jsonp",jsonp:"jsonp",success:function(d){var a=[],e=0,g;if(d&&d.total&&d.total>0&&d.user_timelines)for(g=d.user_timelines.length;e<g;e++){var j=d.user_timelines[e];a.push({date:new Date(j.creation_date*1E3),config:f,html:c.tmpl(h.global,b(j))})}i(a)}});return{template:h}};c.fn.lifestream.feeds.tumblr=function(f,i){var h=c.extend({},
{posted:'posted a ${type} <a href="${url}">${title}</a>'},f.template),b=function(d,a){return{date:new Date(a.date),config:d,html:c.tmpl(h.posted,{type:a.type,url:a.url,title:(a["regular-title"]||a["quote-text"]||a["conversation-title"]||a["photo-caption"]||a["video-caption"]||a["audio-caption"]||a["regular-body"]||a["link-text"]||a.type||"").replace(/<.+?>/gi," ")})}};c.ajax({url:l('select * from tumblr.posts where username="'+f.user+'"'),dataType:"jsonp",success:function(d){var a=[],e=0,g,j;if(d.query&&
d.query.count&&d.query.count>0)if(c.isArray(d.query.results.posts.post))for(g=d.query.results.posts.post.length;e<g;e++){j=d.query.results.posts.post[e];a.push(b(f,j))}else c.isPlainObject(d.query.results.posts.post)&&a.push(b(f,d.query.results.posts.post));i(a)}});return{template:h}};c.fn.lifestream.feeds.twitter=function(f,i){var h=c.extend({},{posted:"{{html tweet}}"},f.template),b=function(d){return function(a){return a.replace(/(^|[^\w'"]+)\#([a-zA-Z0-9_]+)/g,function(e,g,j){return g+'<a href="http://search.twitter.com/search?q=%23'+
j+'">#'+j+"</a>"})}(function(a){return a.replace(/(^|[^\w]+)\@([a-zA-Z0-9_]{1,15})/g,function(e,g,j){return g+'<a href="http://twitter.com/'+j+'">@'+j+"</a>"})}(function(a){return a.replace(/[a-z]+:\/\/[a-z0-9-_]+\.[a-z0-9-_:~%&\?\/.=]+[^:\.,\)\s*$]/ig,function(e){return'<a href="'+e+'">'+(e.length>25?e.substr(0,24)+"...":e)+"</a>"})}(d)))};c.ajax({url:l('select status.id, status.created_at, status.text from twitter.user.timeline where screen_name="'+f.user+'"'),dataType:"jsonp",success:function(d){var a=
[],e=0,g;if(d.query&&d.query.count&&d.query.count>0)for(g=d.query.count;e<g;e++){var j=d.query.results.statuses[e].status;a.push({date:new Date(j.created_at),config:f,html:c.tmpl(h.posted,{tweet:b(j.text)})})}i(a)}});return{template:h}};c.fn.lifestream.feeds.vimeo=function(f,i){var h=c.extend({},{posted:'posted <a href="${url}" title="${description}">${title}</a>'},f.template);c.ajax({url:"http://vimeo.com/api/v2/"+f.user+"/videos.json",dataType:"jsonp",crossDomain:true,success:function(b){var d=
[],a=0,e,g;if(b)for(e=b.length;a<e;a++){g=b[a];d.push({date:new Date(g.upload_date.replace(" ","T")),config:f,html:c.tmpl(h.posted,{url:g.url,description:g.description.replace(/"/g,"'").replace(/<.+?>/gi,""),title:g.title})})}i(d)}});return{template:h}};c.fn.lifestream.feeds.wordpress=function(f,i){var h=c.extend({},{posted:'posted <a href="${link}">${title}</a>'},f.template);c.ajax({url:l('select * from xml where url="http://'+f.user+'.wordpress.com/feed"'),dataType:"jsonp",success:function(b){var d=
[],a=0,e,g;if(b.query&&b.query.count&&b.query.count>0&&b.query.results.rss.channel.item){b=b.query.results.rss.channel.item;for(e=b.length;a<e;a++){g=b[a];d.push({date:new Date(g.pubDate),config:f,html:c.tmpl(h.posted,g)})}}i(d)}});return{template:h}};c.fn.lifestream.feeds.youtube=function(f,i){var h=c.extend({},{favorited:'favorited <a href="${video.player.default}" title="${video.description}">${video.title}</a>'},f.template);c.ajax({url:"http://gdata.youtube.com/feeds/api/users/"+f.user+"/favorites?v=2&alt=jsonc",
dataType:"jsonp",success:function(b){var d=[],a=0,e,g;if(b.data&&b.data.items)for(e=b.data.items.length;a<e;a++){g=b.data.items[a];d.push({date:new Date(g.created),config:f,html:c.tmpl(h.favorited,g)})}i(d)}});return{template:h}}})(jQuery);
